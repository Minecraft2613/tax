<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tax Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    h1 { color: #6df; }
    input, button, select {
      padding: 8px;
      margin: 6px;
      border-radius: 6px;
      border: none;
    }
    #playerList button {
      display: block;
      margin: 4px;
      width: 100%;
      text-align: left;
    }
    .hidden { display: none; }
    .player-profile {
      border: 1px solid #444;
      padding: 15px;
      border-radius: 10px;
      background: #1a1a1a;
      margin-top: 20px;
    }
    .tax-table {
      margin-top: 10px;
    }
    .tax-table td {
      padding: 3px 8px;
    }
  </style>
</head>
<body>
  <h1>ğŸ§¾ Minecraft Tax Tracker</h1>

  <label>ğŸ“ Upload transactions.txt:
    <input type="file" id="uploadFile" accept=".txt" onchange="readFile(event)">
  </label><br>

  <label>ğŸ”€ Sort by:
    <select id="sortSelect" onchange="sortPlayers()">
      <option value="alpha">Alphabetical</option>
      <option value="tax">Top Tax Rank</option>
    </select>
  </label>

  <div id="playerList"></div>

  <div id="playerProfile" class="player-profile hidden"></div>

  <script>
    const webhookUrl = "https://discordapp.com/api/webhooks/your_webhook_here";
    let playerData = {};

    function readFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => parseTransactions(e.target.result);
      reader.readAsText(file);
    }

    function parseTransactions(text) {
      playerData = {};
      const lines = text.split(/\r?\n/);

      for (const line of lines) {
        const match = line.match(/Player (.+?) sold (\d+) x (.+?) for \$([\d.]+)/i);
        if (match) {
          const [, rawName, qty, item, amountStr] = match;
          const name = rawName.trim();
          const amount = parseFloat(amountStr);
          const tax = amount * 0.10;

          if (!playerData[name]) playerData[name] = { tax: 0, items: {} };
          playerData[name].tax += tax;
          playerData[name].items[item] = (playerData[name].items[item] || 0) + tax;
        }
      }
      sortPlayers();
    }

    function sortPlayers() {
      const method = document.getElementById("sortSelect").value;
      const container = document.getElementById("playerList");
      container.innerHTML = "";

      let players = Object.keys(playerData);
      if (method === "alpha") players.sort();
      else players.sort((a, b) => playerData[b].tax - playerData[a].tax);

      for (const name of players) {
        const btn = document.createElement("button");
        btn.textContent = `${name} - $${playerData[name].tax.toFixed(2)} tax`;
        btn.onclick = () => showProfile(name);
        container.appendChild(btn);
      }
    }

    function showProfile(name) {
      const profile = document.getElementById("playerProfile");
      const data = playerData[name];
      profile.innerHTML = `
        <h2>ğŸ‘¤ ${name}'s Profile</h2>
        <p>ğŸ’° Total Tax: <strong>$${data.tax.toFixed(2)}</strong></p>

        <button onclick="document.getElementById('taxItems').classList.toggle('hidden')">ğŸ“¦ Toggle Itemized Tax</button>
        <table id="taxItems" class="tax-table hidden">
          ${Object.entries(data.items).map(([item, val]) => `
            <tr><td>${item}</td><td>$${val.toFixed(2)}</td></tr>
          `).join('')}
        </table>

        <h3>ğŸ’³ Payment Options</h3>
        <button onclick="closeProfile()">âŒ Exit</button>
        <br><br>
        <input type="number" id="payAmount" placeholder="Amount to Pay">
        <button onclick="sendTax('${name}', 'pay')">âœ… Pay Tax</button>
        <button onclick="sendTax('${name}', 'advance')">ğŸ’ Advance Pay</button>
      `;
      profile.classList.remove("hidden");
    }

    function closeProfile() {
      document.getElementById("playerProfile").classList.add("hidden");
    }

    function sendTax(player, type) {
      const amount = parseFloat(document.getElementById("payAmount").value);
      if (isNaN(amount) || amount <= 0) {
        alert("Please enter a valid amount.");
        return;
      }

      const data = {
        content: `ğŸ“¤ **${player}** chose to **${type === 'pay' ? 'Pay Tax' : 'Advance Pay'}**: $${amount.toFixed(2)}`
      };

      fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(() => {
        alert("âœ… Sent to webhook!");
        closeProfile();
      }).catch(() => {
        alert("âŒ Failed to send webhook.");
      });
    }
  </script>
</body>
</html>
