<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player Tax System</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #1e1e1e);
      color: #fff;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      animation: fadeIn 1s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h1 {
      text-align: center;
      color: #ffcc00;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { color: #ffcc00; }
      50% { color: #ff8800; }
    }
    label, select, input, button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 5px;
    }
    input, select {
      background: #222;
      color: #fff;
      border: 1px solid #444;
    }
    button {
      background: #ff8800;
      color: #000;
      cursor: pointer;
      border: none;
    }
    .profile-box {
      margin-top: 20px;
      padding: 20px;
      background: #111;
      border-radius: 10px;
      box-shadow: 0 0 10px #ff8800aa;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ§¾ Player Tax Portal</h1>

    <div id="step1">
      <label for="version">Minecraft Version:</label>
      <select id="version">
        <option value="Java">Java</option>
        <option value="Bedrock">Bedrock</option>
      </select>

      <label for="contact">Contact Method:</label>
      <select id="contact">
        <option value="Discord">Discord</option>
        <option value="Instagram">Instagram</option>
      </select>

      <label for="mcid">Minecraft Username (ID):</label>
      <input type="text" id="mcid" placeholder="e.g. Steve or steve.123">

      <button onclick="nextStep()">Next</button>
    </div>

    <div id="profile" class="hidden"></div>
  </div>

  <script>
    const paidPlayers = JSON.parse(localStorage.getItem('paidPlayers') || '{}');
    let playerData = {};
    let currentPlayer = '';

    async function nextStep() {
      const version = document.getElementById('version').value;
      const contact = document.getElementById('contact').value;
      const mcid = document.getElementById('mcid').value.trim();
      if (!mcid) return alert('Please enter a Minecraft ID');

      currentPlayer = mcid;
      document.getElementById('step1').classList.add('hidden');

      const payload = {
        version, contact, mcid,
        time: new Date().toISOString()
      };

      fetch('https://discordapp.com/api/webhooks/1385267628842684526/7aw6Ms9TLRUHfEvQK0Y6aQvj8zwy4TS0WIgdRQe0iGcOZeZg3r95gT3UTep4jhK3NhWZ', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: `ðŸ“¥ New Entry:\nVersion: ${version}\nContact: ${contact}\nMinecraft ID: ${mcid}` })
      });

      loadTax();
    }

    async function loadTax() {
      const url = 'https://raw.githubusercontent.com/Minecraft2613/tax/main/transaction-log.txt';
      const res = await fetch(url);
      const log = await res.text();
      parseLog(log);
    }

    function parseLog(content) {
      const lines = content.split(/\r?\n/);
      const taxRecords = {};

      lines.forEach(line => {
        const match = line.match(/- ([\w.]+) sold .*? for \$(\d+(?:,\d+)?(?:\.\d+)?)/);
        if (match) {
          const name = match[1];
          const amount = parseFloat(match[2].replace(/,/g, ''));
          const tax = Math.round(amount * 0.10 * 100) / 100;

          if (!taxRecords[name]) {
            taxRecords[name] = { tax: 0, advanced: 0 };
          }

          taxRecords[name].tax += tax;
        }
      });

      playerData = taxRecords;
      renderProfile(currentPlayer);
    }

    function renderProfile(name) {
      const p = playerData[name];
      const paid = paidPlayers[name] || 0;
      const due = Math.max(0, (p?.tax || 0) - paid);
      const advanced = paid > (p?.tax || 0);

      if (!p) return document.getElementById('profile').innerHTML = '<div class="profile-box">Player not found.</div>';

      const html = `
        <div class="profile-box">
          <h2>Welcome, ${name}</h2>
          <p>Status: <strong>${due === 0 ? (advanced ? 'Advance Paid' : 'No Tax Due') : '$' + due.toFixed(2) + ' Tax Due'}</strong></p>

          ${due > 0 ? `
          <input type="number" id="payAmt" placeholder="Amount to Pay">
          <button onclick="submitTax('${name}', ${p.tax})">Pay</button>
          ` : ''}
        </div>`;

      document.getElementById('profile').classList.remove('hidden');
      document.getElementById('profile').innerHTML = html;
    }

    function submitTax(name, totalTax) {
      const amt = parseFloat(document.getElementById('payAmt').value);
      if (!amt || amt <= 0) return alert('Enter a valid amount');

      paidPlayers[name] = (paidPlayers[name] || 0) + amt;
      localStorage.setItem('paidPlayers', JSON.stringify(paidPlayers));

      fetch('https://discordapp.com/api/webhooks/YOUR_WEBHOOK_URL', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: `ðŸ’° Payment: ${name} paid $${amt}` })
      });

      renderProfile(name);
    }
  </script>
</body>
</html>
